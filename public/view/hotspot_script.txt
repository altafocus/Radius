:local validity %validity%; :local price %price%; :local sales %sales%; :local string [/ip hotspot user get [find name=$user] comment]; :local phone [:pick $string 0 [find $string "/"]]; :local date [/system clock get date]; :local time [/system clock get time]; {:if ([/system scheduler find name=$user]="") do={/system scheduler add name=$user policy="read,write" interval=$validity on-event="/ip hotspot user remove [find name=$user]; /ip hotspot active remove [find user=$user]; /ip hotspot cookie remove [find name=$user]; /system scheduler remove [find name=$user]"; :if ([/system script find name=$date]="") do={/system script add name=$date policy="read,write" source="$user/$price/$sales/$date/$time/$phone";} else={:local db [/system script get [find name=$date] source]; /system script set source="$db\r\n$user/$price/$sales/$date/$time/$phone" [find name=$date]; :if ([/system script find name="total"]="") do={/system script add name="total" source="$price" policy="read,write";} else={:local balance [/system script get [find name="total"] source]; :local amount ($balance + $price); /system script set source="$amount" [find name="total"]; beep; }}}}